import{d as B,u as h,g as x,o as G,O as K,c as o,e as E,b as t,i as v,k as d,_ as Y,t as i,w as p,v as T,ac as S,a9 as R,F as m,l as $,K as w,f as a,ad as z,m as g,x as A}from"./index-5oEvAc_v.js";import{u as k}from"./useapi-ChtrIuLC.js";const q={key:0,class:"border rounded-lg p-4 bg-white shadow mb-6 space-y-4"},J={class:"grid gap-4 md:grid-cols-2"},Q={key:0},W={key:0,class:"mt-4"},X={key:0,class:"space-y-2 max-h-48 overflow-auto"},Z=["value"],ee=["disabled"],te={class:"grid grid-cols-2 gap-4"},le={class:"text-lg font-bold text-gray-800"},se={class:"text-sm text-gray-600 mt-1"},ne={class:"text-sm text-gray-700 space-y-1"},oe={key:0},ae={key:2},ie={key:0},de={class:"mt-4"},ue=["onClick"],ge=B({__name:"Smshandle",setup(re){const u=h().params.id,{fetchData:_,data:f,loading:U,error:c}=k("GET",`/api/v0/sms-service/${u}/`),y=x([]),D=x("");G(async()=>{await _(),c.value?D.value=c.value:f.value&&(y.value=f.value)});const{fetchData:F,data:C,loading:L,error:O}=k("GET",`/api/v0/scenes/${u}`),{fetchData:I,loading:j,error:M}=k("POST",`/api/v0/sms-service/${u}/create/`),b=x(!1),s=x({event:+u,title:"",text:"",condition_send:0,is_vip:null,in_hall:null,scenes:[],guests:[],datetime_send:""});K(()=>s.value.condition_send,async n=>{[4,5,6].includes(n)?await F():s.value.scenes=[]});const H=async()=>{if(!s.value.title||!s.value.text)return w("عنوان و متن پیامک را پر کنید");const n={...s.value};[4,5,6].includes(n.condition_send)&&delete n.datetime_send,n.datetime_send===""&&delete n.datetime_send,Object.entries(n).forEach(([e,l])=>{l===null&&delete n[e]}),await I(n),M.value?w("خطا در ایجاد پیامک: "+M.value):(await _(),y.value=f.value||[],b.value=!1,s.value={event:+u,title:"",text:"",datetime_send:"",condition_send:0,is_vip:null,in_hall:null,scenes:[],guests:[]})},V=n=>{if(/^\d{2}:\d{2}:\d{2}$/.test(n)){const[l,r]=n.split(":");return`${l}:${r}`}try{return new Intl.DateTimeFormat("fa-IR",{dateStyle:"medium",timeStyle:"short"}).format(new Date(n))}catch{return n}},N=async n=>{const{fetchData:e}=k("DELETE",`/api/v0/sms-service/${u}/${n}/delete/`);try{await e(),w("پیامک پاک شد"),await _(),c.value?D.value=c.value:f.value&&(y.value=f.value)}catch{w("مشکلی پیش آمد")}};return(n,e)=>(a(),o(m,null,[E(Y,{message:"",error:D.value,loading:d(U)},null,8,["error","loading"]),t("button",{class:"mb-6 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:e[0]||(e[0]=l=>b.value=!b.value)},i(b.value?"لغو":"ایجاد پیامک جدید"),1),b.value?(a(),o("div",q,[t("div",J,[t("div",null,[e[8]||(e[8]=t("label",{class:"block font-medium"},"عنوان",-1)),p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.title=l),type:"text",class:"w-full border rounded px-2 py-1"},null,512),[[T,s.value.title]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"block font-medium"},"متن",-1)),p(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.text=l),class:"w-full border rounded px-2 py-1",rows:"3"},null,512),[[T,s.value.text]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block font-medium"},"شرط ارسال",-1)),p(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.condition_send=l),class:"w-full border rounded px-2 py-1"},e[10]||(e[10]=[t("option",{value:0},"در لحظه",-1),t("option",{value:2},"در صورت حضور به موقع",-1),t("option",{value:3},"در صورت دیر رسیدن",-1),t("option",{value:4},"شروع سین",-1),t("option",{value:6},"پایان سین",-1)]),512),[[S,s.value.condition_send,void 0,{number:!0}]])]),s.value.condition_send===1?(a(),o("div",Q,[e[12]||(e[12]=t("label",{class:"block font-medium"},"زمان ارسال",-1)),E(d(R),{modelValue:s.value.datetime_send,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.datetime_send=l),type:"datetime",format:"YYYY-MM-DD HH:mm:00",displayFormat:"HH:mm:00 jYYYY-jMM-jDD",class:"w-full"},null,8,["modelValue"])])):v("",!0),t("div",null,[e[14]||(e[14]=t("label",{class:"block font-medium"},"فیلتر VIP",-1)),p(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.is_vip=l),class:"w-full border rounded px-2 py-1"},e[13]||(e[13]=[t("option",{value:null},"همه مهمانان",-1),t("option",{value:!1},"مهمانان عادی",-1),t("option",{value:!0},"فقط VIP",-1)]),512),[[S,s.value.is_vip]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block font-medium"},"فیلتر در سالن",-1)),p(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.in_hall=l),class:"w-full border rounded px-2 py-1"},e[15]||(e[15]=[t("option",{value:null},"همه مهمانان",-1),t("option",{value:!1},"خارج سالن",-1),t("option",{value:!0},"فقط داخل سالن",-1)]),512),[[S,s.value.in_hall]])])]),[4,5,6].includes(s.value.condition_send)?(a(),o("div",W,[e[17]||(e[17]=t("h4",{class:"font-medium mb-2"},"انتخاب سکانس‌ها",-1)),E(Y,{message:"",error:d(O)??void 0,loading:d(L)},null,8,["error","loading"]),d(C)?(a(),o("div",X,[(a(!0),o(m,null,$(d(C),l=>(a(),o("label",{key:l.id,class:"flex items-center gap-2"},[p(t("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":e[7]||(e[7]=r=>s.value.scenes=r)},null,8,Z),[[z,s.value.scenes]]),t("span",null,i(l.name)+" ("+i(V(l.start_time))+" → "+i(V(l.end_time))+") ",1)]))),128))])):v("",!0)])):v("",!0),t("button",{class:"mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",disabled:d(j),onClick:H},"ذخیره پیامک",8,ee)])):v("",!0),t("div",te,[(a(!0),o(m,null,$(y.value,l=>(a(),o("div",{key:l.id,class:"border rounded-lg bg-white shadow p-6 w-full space-y-3"},[t("div",null,[t("h3",le,i(l.title),1),t("p",se,i(l.text),1)]),t("ul",ne,[l.datetime_send?(a(),o("li",oe,[e[18]||(e[18]=t("strong",null,"ارسال:",-1)),g(" "+i(V(l.datetime_send)),1)])):(a(),o(m,{key:1},[t("li",null,[e[19]||(e[19]=t("strong",null,"وضعیت مهمانان:",-1)),g(" "+i(l.is_vip_str),1)]),t("li",null,[e[20]||(e[20]=t("strong",null,"وضعیت سالن:",-1)),g(" "+i(l.in_hall_str),1)])],64)),l.scenes.length?(a(),o("li",ae,[e[21]||(e[21]=t("strong",null,"سکانس‌ها:",-1)),t("span",null,[(a(!0),o(m,null,$(l.scenes,(r,P)=>(a(),o(m,null,[g(i(r),1),P<l.scenes.length-1?(a(),o("span",ie,"، ")):v("",!0)],64))),256))])])):v("",!0),t("li",null,[e[22]||(e[22]=t("strong",null,"شرط:",-1)),g(" "+i(l.condition_send_str),1)]),t("li",null,[e[23]||(e[23]=t("strong",null,"هزینه:",-1)),g(" "+i(l.cost)+" تومان",1)]),t("li",null,[e[24]||(e[24]=t("strong",null,"وضعیت:",-1)),t("span",{class:A(l.status?"text-green-700 bg-green-100 px-2 py-0.5 rounded":"text-red-700 bg-red-100 px-2 py-0.5 rounded")},i(l.status?"ارسال شده":"ارسال نشده"),3)])]),t("div",de,[t("button",{onClick:r=>N(l.id),class:"text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded focus:outline-none focus:ring-2 focus:ring-red-500"}," حذف ",8,ue)])]))),128))])],64))}});export{ge as default};
